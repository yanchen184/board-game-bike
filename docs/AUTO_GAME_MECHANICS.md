# 自動遊戲機制說明

## 概述

從 v1.1.0 開始，遊戲採用**完全自動化**的遊戲流程。玩家在遊戲開始前完成所有策略配置，然後觀看30秒的自動演示，最後查看結果。

## 遊戲流程

### 1. 設置階段（Setup Phase）

玩家需要完成4個步驟的配置：

#### Step 1: 選擇團隊成員
- 從8種角色中選擇2-4名隊員
- 預算限制：$5000
- 每個角色有不同的能力和成本

#### Step 2: 配置裝備
選擇腳踏車的三個主要部件：
- **車架** - 影響重量和空氣動力
- **輪組** - 影響速度和操控
- **變速系統** - 影響精準度和效率

#### Step 3: 設定初始隊形
選擇起始破風隊形：
- **單線隊形** - 20% 風阻減少
- **雙線並行** - 15% 風阻減少，更靈活
- **火車陣型** - 25% 最佳破風效果

#### Step 4: 策略設定 ⭐ NEW
配置5個核心策略決策：

##### 4.1 比賽節奏策略
- **保守推進** 🐢
  - 速度：80%
  - 體力消耗：-20%
  - 適合：追求高完成率，不在意時間

- **均衡推進** ⚖️
  - 速度：100%
  - 體力消耗：標準
  - 適合：平衡風險與回報

- **激進推進** 🐇
  - 速度：120%
  - 體力消耗：+30%
  - 適合：追求最快時間，高風險高回報

##### 4.2 補給站策略
- **跳過補給** ⚡
  - 不停留，節省時間
  - 體力恢復：0%
  - 士氣：-5

- **快速補給** 🍌
  - 停留5分鐘
  - 體力恢復：15%
  - 士氣：+5

- **完整休息** 🍔
  - 停留20分鐘
  - 體力恢復：50%
  - 士氣：+15

##### 4.3 爬坡應對策略
- **單線隊形** ➡️
  - 爬坡時切換為單線
  - 效率最高，需要30秒切換時間

- **雙人並行** 👥
  - 保持彈性
  - 效率略低但不浪費時間

- **維持原隊形** 🔒
  - 不切換隊形
  - 爬坡速度較慢

##### 4.4 機械故障應對策略
- **快速修復** 🔧
  - 簡單修理，5分鐘
  - 可能再次故障

- **徹底維修** 🛠️
  - 完整修理，15分鐘
  - 不會再次故障

- **繼續前進** 💨
  - 不修理，繼續騎行
  - 速度-20%，高風險

##### 4.5 體力輪替設定
- 設定體力閾值（20-50%）
- 當領騎體力低於閾值時自動輪替
- **20-25%**：激進設定，追求速度
- **30-40%**：均衡設定，推薦新手
- **45-50%**：保守設定，確保完成

---

### 2. 比賽階段（Racing Phase）

#### 2.1 自動模擬引擎

遊戲使用 `AutoGameSimulator` 自動執行整場比賽：

```javascript
// 模擬配置
{
  team: teamMembers,        // 團隊成員
  bike: bikeStats,          // 裝備配置
  formation: initialFormation, // 初始隊形
  strategy: strategyConfig,    // 策略設定
  targetDuration: 30,       // 30秒動畫
  fps: 30                   // 30 FPS
}
```

#### 2.2 自動決策系統

模擬器根據預設策略自動處理所有事件：

**補給站事件**
```
IF 到達補給站 THEN
  根據 strategy.supplyStrategy 執行對應操作
  - skip: 跳過（+0體力，+0時間）
  - quick: 快速補給（+15%體力，+5分鐘）
  - full: 完整休息（+50%體力，+20分鐘）
END
```

**機械故障事件**
```
IF 發生機械故障 THEN
  根據 strategy.mechanicalStrategy 執行對應操作
  - quick_fix: 快速修復（+5分鐘，可能再故障）
  - thorough_repair: 徹底維修（+15分鐘，不再故障）
  - continue: 繼續前進（速度-20%，士氣-10）
END
```

**爬坡地形**
```
IF 進入爬坡路段 THEN
  根據 strategy.climbingStrategy 調整隊形
  - single: 切換單線隊形（+30秒切換時間）
  - double: 切換雙線隊形
  - maintain: 維持原隊形
END
```

**體力輪替**
```
EVERY 幀檢查:
  IF 領騎體力 < strategy.rotationThreshold THEN
    自動找體力最高的隊員接手領騎
  END
END
```

#### 2.3 動畫演示系統

使用 GSAP 播放 30 秒流暢動畫：

- **關鍵快照**：100個關鍵時刻
- **幀率**：30 FPS
- **插值**：線性插值產生流暢動畫
- **時間壓縮**：12小時真實時間 → 30秒動畫

**顯示內容**：
- 即時距離和時間
- 當前速度
- 地形類型（平路/爬坡/下坡）
- 天氣狀況
- 隊形狀態
- 團隊士氣
- 每個隊員的體力條
- 領騎標示

---

### 3. 結果階段（Results Phase）

演示完成後自動跳轉至結果頁面，顯示：

- 完成狀態（成功/失敗）
- 完成時間
- 完成距離
- 團隊完成率
- 平均疲勞度
- 最終士氣
- 統計數據（補給次數、機械故障、處理事件數）
- 最終得分和排行榜

---

## 技術架構

### 核心組件

#### 1. `src/store/strategySlice.js`
Redux slice 管理策略狀態：
```javascript
{
  paceStrategy: 'balanced' | 'conservative' | 'aggressive',
  supplyStrategy: 'skip' | 'quick' | 'full',
  climbingStrategy: 'single' | 'double' | 'maintain',
  mechanicalStrategy: 'quick_fix' | 'thorough_repair' | 'continue',
  rotationThreshold: 20-50 (number)
}
```

#### 2. `src/components/StrategyConfig.jsx`
策略配置 UI 組件：
- 卡片式選擇介面
- 即時預覽效果
- 策略總結面板
- 滑桿調整體力閾值

#### 3. `src/services/AutoGameSimulator.js`
自動模擬引擎：
- `runAutoSimulation()` - 執行完整模擬
- `autoHandleEvent()` - 自動處理事件
- `autoAdjustFormation()` - 自動調整隊形
- `autoRotateLeader()` - 自動輪替領騎
- `interpolateSnapshot()` - 插值計算中間幀

#### 4. `src/components/AutoGameSimulator.jsx`
React 動畫組件：
- GSAP timeline 控制
- 即時數據更新
- 進度條顯示
- 完成回調

---

## 遊戲平衡

### 策略效果表

| 策略類型 | 選項 | 速度影響 | 體力影響 | 時間影響 | 風險 |
|---------|------|---------|---------|---------|------|
| **節奏** | 保守 | 80% | -20%消耗 | 慢 | 低 |
| | 均衡 | 100% | 標準 | 中 | 中 |
| | 激進 | 120% | +30%消耗 | 快 | 高 |
| **補給** | 跳過 | - | 0% | 0分鐘 | 高 |
| | 快速 | - | +15% | +5分鐘 | 中 |
| | 完整 | - | +50% | +20分鐘 | 低 |
| **爬坡** | 單線 | +效率 | - | +30秒 | - |
| | 雙線 | 中效率 | - | 0 | - |
| | 維持 | -效率 | - | 0 | - |
| **故障** | 快速 | - | - | +5分鐘 | 可能再故障 |
| | 徹底 | - | - | +15分鐘 | 不再故障 |
| | 繼續 | -20% | 士氣-10 | 0 | 極高 |

### 推薦策略組合

#### 速度優先（高風險）
- 節奏：激進
- 補給：跳過
- 爬坡：單線
- 故障：繼續前進
- 輪替：20%

**優點**：最快完成時間
**缺點**：高失敗率

#### 穩健完成（推薦新手）
- 節奏：均衡
- 補給：快速
- 爬坡：單線
- 故障：快速修復
- 輪替：35%

**優點**：平衡時間與成功率
**缺點**：無明顯優勢

#### 保守完成（高成功率）
- 節奏：保守
- 補給：完整休息
- 爬坡：維持
- 故障：徹底維修
- 輪替：50%

**優點**：幾乎100%完成率
**缺點**：時間較長

---

## 開發者指南

### 修改策略選項

編輯 `src/components/StrategyConfig.jsx` 中的 `strategies` 對象：

```javascript
const strategies = {
  pace: [
    {
      id: 'conservative',
      name: '保守推進',
      icon: '🐢',
      desc: '速度 80%，體力消耗 -20%',
      pros: '✅ 高成功率，穩定完成',
      cons: '❌ 完成時間較長',
    },
    // 添加更多選項...
  ],
  // ...
}
```

### 調整模擬參數

編輯 `src/services/AutoGameSimulator.js`：

```javascript
// 修改動畫時長
targetDuration: 30, // 改為 60 秒

// 修改隨機事件發生率
const shouldTriggerEvent = Math.random() < 0.15; // 調整機率

// 修改效果數值
function getSupplyStationEffects(strategy) {
  // 修改體力恢復量、時間消耗等
}
```

### 添加新事件類型

1. 在 `src/data/events.js` 添加新事件模板
2. 在 `AutoGameSimulator.js` 添加處理邏輯
3. 在 `StrategyConfig.jsx` 添加策略選項
4. 在 `strategySlice.js` 添加狀態欄位

---

## 已知限制

1. **固定動畫時長**：30秒無法調整（可在代碼中修改）
2. **無中途暫停**：動畫開始後無法暫停或重新配置
3. **策略不可改**：一旦開始無法修改策略
4. **隨機性**：每次執行結果可能略有不同（隨機事件）

---

## 未來改進方向

- [ ] 可調整動畫速度（15秒/30秒/60秒）
- [ ] 添加更多策略維度（飲食策略、休息策略）
- [ ] AI 策略建議系統
- [ ] 策略效果統計分析
- [ ] 多次模擬對比功能
- [ ] 策略模板保存/載入

---

## 版本歷史

### v1.1.0 (2025-11-20)
- ✨ 新增完整自動化遊戲系統
- ✨ 新增策略預設系統（5個核心決策）
- ✨ 新增 30 秒自動演示動畫
- 🔄 重構 GamePage 為純觀看模式
- 🔄 重構 SetupPage 新增策略設定步驟
- 🎨 優化 UI/UX 設計
- 📝 完善文檔

### v1.0.0 (2025-11-19)
- 🎮 原版即時互動遊戲系統
- ⚡ 時間加速功能
- 🎯 手動決策系統
